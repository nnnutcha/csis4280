
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Hand Processor</title>
<style>
body { margin: 0; overflow: hidden; background: black; }
#video { display: none; }
</style>

<script crossorigin src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script crossorigin src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script crossorigin src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

</head>
<body>
<video id="video" playsinline></video>
<canvas id="canvas"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function setupCanvas() {
    canvas.width = 300;
    canvas.height = 300;
}
setupCanvas();

async function init() {
    const constraints = { video: { facingMode: "user", width: 300, height: 300 }};
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    await video.play();

    const hands = new Hands({
        locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
    });

    hands.setOptions({
        maxNumHands: 1,
        minDetectionConfidence: 0.6,
        minTrackingConfidence: 0.6
    });

    hands.onResults(results => {
        ctx.clearRect(0,0,canvas.width,canvas.height);

        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const lms = results.multiHandLandmarks[0];
            ctx.strokeStyle = "cyan";
            ctx.lineWidth = 3;

            for (let lm of lms) {
                ctx.beginPath();
                ctx.arc(lm.x * canvas.width, lm.y * canvas.height, 3, 0, Math.PI*2);
                ctx.fillStyle = "lime";
                ctx.fill();
            }

            window.ReactNativeWebView?.postMessage(JSON.stringify({ landmarks: [lms] }));
        }
    });

    const camera = new Camera(video, {
        onFrame: async () => {
            await hands.send({ image: video });
        },
        width: 300,
        height: 300
    });
    camera.start();
}

init();
</script>

</body>
</html>
